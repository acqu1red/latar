# Генератор планов квартир

Система для генерации профессиональных планов квартир на основе загруженных фотографий с использованием Scribble Diffusion API и локальной Stable Diffusion.

## Функциональность

- Загрузка фотографии плана квартиры
- Анализ изображения с помощью AI
- Создание эскиза из загруженного изображения
- Генерация профессионального плана с помощью Scribble Diffusion API
- Локальная генерация как fallback
- Современный и отзывчивый интерфейс

## Установка и запуск

### Backend

1. Перейдите в папку backend:
```bash
cd backend
```

2. Установите зависимости:
```bash
npm install
```

3. Создайте файл `.env` в папке `backend/` и добавьте переменные окружения:
```env
# Scribble Diffusion API Configuration
SCRIBBLE_DIFFUSION_API_KEY=ваш_scribble_diffusion_api_ключ_здесь

# Server Configuration
NODE_ENV=development
PORT=3001
```

**Как получить Scribble Diffusion API ключ:**
1. Зарегистрируйтесь у вашего провайдера Scribble Diffusion API
2. Получите API ключ в личном кабинете
3. Вставьте его в файл `.env`

**Важно:** Без API ключа система будет использовать локальную генерацию как fallback!

5. Запустите сервер:
```bash
npm start
```

Сервер будет доступен на `http://localhost:3001`

### Frontend

1. Перейдите в папку frontend:
```bash
cd frontend
```

2. Установите зависимости:
```bash
npm install
```

3. Запустите dev сервер:
```bash
npm run dev
```

Приложение будет доступно на `http://localhost:5173`

## Использование

1. Откройте приложение в браузере
2. Загрузите фотографию плана квартиры
3. Нажмите "Сгенерировать"
4. Система автоматически:
   - Создаст эскиз из вашего изображения
   - Сгенерирует профессиональный план с помощью Scribble Diffusion API
   - При необходимости переключится на локальную генерацию
5. Скачайте готовый план

## Технологии

- **Frontend**: React, TypeScript, Vite
- **Backend**: Node.js, Express, Multer
- **AI**: Scribble Diffusion API, локальная Stable Diffusion
- **Обработка изображений**: Sharp, ControlNet
- **Стили**: CSS3 с градиентами и анимациями

## Структура проекта

```
├── frontend/          # React приложение
│   ├── src/
│   │   ├── App.tsx    # Главный компонент
│   │   ├── App.css    # Стили
│   │   └── config.ts  # Конфигурация API
├── backend/           # Express сервер
│   ├── src/
│   │   ├── scribbleDiffusionGenerator.mjs  # Основной модуль генерации
│   │   ├── imageAnalyzer.mjs               # Анализ изображений
│   │   ├── localStableDiffusion.mjs        # Локальная генерация
│   │   └── simpleLocalGenerator.mjs        # Простая локальная генерация
│   └── server.mjs     # Express сервер
└── koyeb.yaml        # Конфигурация для Koyeb
```

## Генерация планов

Система использует многоуровневый подход к генерации:

1. **Анализ изображения**: AI анализирует загруженное фото плана
2. **Создание эскиза**: Автоматическое создание контурного эскиза
3. **Scribble Diffusion API**: Генерация профессионального плана
4. **Локальная генерация**: Fallback при недоступности API
5. **Простая генерация**: Базовый fallback для всех случаев

## Развертывание

Для развертывания на Koyeb используйте файл `koyeb.yaml` в корне проекта.

## Требования

- Node.js 18+
- Scribble Diffusion API ключ (опционально)
- Современный браузер с поддержкой ES6+

## Переменные окружения

См. файл `ENV_EXAMPLE.md` для примера настройки переменных окружения.