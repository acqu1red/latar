# Исправление ошибки "Missing required parameter: 'image'"

## Проблема

OpenAI API `images.edit` не поддерживает параметр `image_url` - он ожидает только `image` с Buffer или base64 данными. Это вызывало ошибку:

```
BadRequestError: 400 Missing required parameter: 'image'.
```

## Решение

### 1. Добавлена функция загрузки изображений по URL

```javascript
async function downloadImageAsBase64(imageUrl) {
  const response = await fetch(imageUrl);
  const buffer = await response.buffer();
  return buffer.toString('base64');
}
```

### 2. Обновлён процесс обработки изображений

1. **Сжатие** изображения до 768×768 пикселей
2. **Загрузка на GitHub** или локальное сохранение
3. **Получение публичного URL** изображения
4. **Загрузка изображения по URL** и конвертация в base64
5. **Передача base64 в API** `images.edit`
6. **Очистка** временных файлов

### 3. Установлена зависимость node-fetch

```bash
npm install node-fetch
```

## Процесс работы

```
Сжимаем изображение для экономии памяти...
Размер исходного изображения: 1794879 байт
Сжатие завершено. Экономия памяти: 88%
Размер сжатого изображения: 221828 байт
GitHub не настроен, используем локальную загрузку
Временный файл создан: temp-1758111712069-nodojkkt8.png
Публичный URL изображения: https://acqu1red.github.io/latar/temp-images/temp-1758111712069-nodojkkt8.png
Загружаем изображение по URL: https://acqu1red.github.io/latar/temp-images/temp-1758111712069-nodojkkt8.png
Изображение загружено, размер: 221828 байт
GPT Image генерация завершена
```

## Преимущества решения

✅ **Совместимость с API** - использует правильный формат данных  
✅ **Гибкость** - работает как с GitHub, так и с локальными файлами  
✅ **Надёжность** - обрабатывает ошибки загрузки изображений  
✅ **Экономия памяти** - не хранит большие Buffer в памяти  

## Технические детали

- **API**: `images.edit` с параметром `image` (Buffer)
- **Формат данных**: base64 → Buffer
- **Загрузка**: fetch API для получения изображений по URL
- **Обработка ошибок**: try/catch для всех операций с сетью

## Устранение неполадок

### Ошибка "HTTP error! status: 404"
- Проверьте, что публичный URL изображения доступен
- Убедитесь, что файл существует на GitHub или локальном сервере

### Ошибка "Failed to fetch"
- Проверьте сетевое соединение
- Убедитесь, что URL изображения корректный

### Ошибка "Missing required parameter: 'image'"
- Убедитесь, что используется `image` вместо `image_url`
- Проверьте, что Buffer создан корректно из base64
